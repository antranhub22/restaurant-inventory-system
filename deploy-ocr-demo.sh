#!/bin/bash

echo "ğŸš€ Deploying OCR Demo to Render"
echo "================================"

# Kiá»ƒm tra git status
if [ -n "$(git status --porcelain)" ]; then
    echo "âš ï¸  CÃ³ thay Ä‘á»•i chÆ°a commit. Commit trÆ°á»›c khi deploy:"
    git status
    echo ""
    echo "Cháº¡y cÃ¡c lá»‡nh sau:"
    echo "git add ."
    echo "git commit -m 'Update OCR demo for Render deployment'"
    echo "git push origin main"
    exit 1
fi

echo "âœ… Git repository sáº¡ch"

# Kiá»ƒm tra render.yaml
if [ ! -f "render.yaml" ]; then
    echo "âŒ File render.yaml khÃ´ng tá»“n táº¡i"
    exit 1
fi

echo "âœ… File render.yaml tá»“n táº¡i"

# Kiá»ƒm tra backend Dockerfile
if [ ! -f "backend/Dockerfile" ]; then
    echo "âŒ File backend/Dockerfile khÃ´ng tá»“n táº¡i"
    exit 1
fi

echo "âœ… Backend Dockerfile tá»“n táº¡i"

# Kiá»ƒm tra frontend build script
if [ ! -f "frontend/render-build.sh" ]; then
    echo "âŒ File frontend/render-build.sh khÃ´ng tá»“n táº¡i"
    exit 1
fi

echo "âœ… Frontend build script tá»“n táº¡i"

# Kiá»ƒm tra environment files
if [ ! -f "frontend/.env.production" ]; then
    echo "âŒ File frontend/.env.production khÃ´ng tá»“n táº¡i"
    exit 1
fi

echo "âœ… Production environment file tá»“n táº¡i"

echo ""
echo "ğŸ“‹ Checklist trÆ°á»›c khi deploy:"
echo "1. âœ… Git repository sáº¡ch"
echo "2. âœ… render.yaml configured"
echo "3. âœ… Backend Dockerfile ready"
echo "4. âœ… Frontend build script ready"
echo "5. âœ… Environment variables set"
echo ""
echo "ğŸ”§ CÃ¡c bÆ°á»›c deploy:"
echo "1. Push code lÃªn GitHub"
echo "2. Connect repository vá»›i Render"
echo "3. Configure environment variables"
echo "4. Deploy services"
echo ""
echo "ğŸ“ HÆ°á»›ng dáº«n chi tiáº¿t:"
echo ""
echo "1. Push code:"
echo "   git push origin main"
echo ""
echo "2. TrÃªn Render Dashboard:"
echo "   - Táº¡o New Web Service cho backend"
echo "   - Táº¡o New Static Site cho frontend"
echo "   - Connect vá»›i GitHub repository"
echo ""
echo "3. Environment Variables (Backend):"
echo "   - NODE_ENV=production"
echo "   - PORT=4000"
echo "   - DATABASE_URL=<your-neon-database-url>"
echo "   - JWT_SECRET=<auto-generated>"
echo "   - FRONTEND_URL=https://restaurant-inventory-frontend.onrender.com"
echo ""
echo "4. Environment Variables (Frontend):"
echo "   - VITE_API_URL=https://restaurant-inventory-backend.onrender.com"
echo "   - VITE_ENV=production"
echo ""
echo "5. Build Commands:"
echo "   Backend: (auto-detect Dockerfile)"
echo "   Frontend: cd frontend && ./render-build.sh"
echo ""
echo "6. Publish Directory (Frontend):"
echo "   ./frontend/dist"
echo ""
echo "ğŸŒ URLs sau khi deploy:"
echo "   Backend: https://restaurant-inventory-backend.onrender.com"
echo "   Frontend: https://restaurant-inventory-frontend.onrender.com"
echo "   OCR Demo: https://restaurant-inventory-frontend.onrender.com/ocr-demo"
echo ""
echo "ğŸ” Kiá»ƒm tra sau deploy:"
echo "   - Backend health: https://restaurant-inventory-backend.onrender.com/api/health"
echo "   - Frontend load: https://restaurant-inventory-frontend.onrender.com"
echo "   - OCR demo: https://restaurant-inventory-frontend.onrender.com/ocr-demo"
echo ""
echo "ğŸ“ Troubleshooting:"
echo "   - Kiá»ƒm tra Render logs"
echo "   - Verify environment variables"
echo "   - Test API endpoints"
echo "   - Check CORS configuration"
echo ""
echo "âœ… Sáºµn sÃ ng deploy! Cháº¡y 'git push origin main' Ä‘á»ƒ báº¯t Ä‘áº§u."