# 🚀 Hướng dẫn Deploy OCR Demo lên Render

## 📋 Tổng quan

Hướng dẫn chi tiết cách deploy hệ thống Restaurant Inventory với OCR Demo lên Render.com.

## 🎯 Kết quả sau khi deploy

- **Backend**: https://restaurant-inventory-backend.onrender.com
- **Frontend**: https://restaurant-inventory-frontend.onrender.com
- **OCR Demo**: https://restaurant-inventory-frontend.onrender.com/ocr-demo

## 🔧 Chuẩn bị trước khi deploy

### 1. Kiểm tra code
```bash
# Chạy script kiểm tra
./deploy-ocr-demo.sh
```

### 2. Commit và push code
```bash
git add .
git commit -m "Update OCR demo for Render deployment"
git push origin main
```

## 🌐 Deploy lên Render

### Bước 1: Tạo tài khoản Render
1. Truy cập https://render.com
2. Đăng ký tài khoản (có thể dùng GitHub)
3. Verify email

### Bước 2: Connect GitHub Repository
1. Trên Render Dashboard, click "New +"
2. Chọn "Blueprint" (sử dụng render.yaml)
3. Connect với GitHub repository
4. Chọn repository chứa code

### Bước 3: Configure Backend Service

#### Environment Variables
```
NODE_ENV=production
PORT=4000
DATABASE_URL=postgresql://user:pass@host/database?sslmode=require
JWT_SECRET=<auto-generated>
FRONTEND_URL=https://restaurant-inventory-frontend.onrender.com
```

#### Database Setup (Neon.tech)
1. Tạo tài khoản tại https://neon.tech
2. Tạo database mới
3. Copy DATABASE_URL
4. Paste vào Render environment variables

### Bước 4: Configure Frontend Service

#### Environment Variables
```
VITE_API_URL=https://restaurant-inventory-backend.onrender.com
VITE_ENV=production
```

#### Build Settings
- **Build Command**: `cd backend/frontend && ./render-build.sh`
- **Publish Directory**: `./backend/frontend/dist`

## 🔍 Kiểm tra sau deploy

### 1. Backend Health Check
```bash
curl https://restaurant-inventory-backend.onrender.com/api/health
```

**Expected Response:**
```json
{
  "status": "OK",
  "timestamp": "2025-01-07T10:30:00.000Z",
  "environment": "production",
  "services": {
    "database": "connected",
    "redis": "not configured"
  }
}
```

### 2. Frontend Load Test
- Truy cập: https://restaurant-inventory-frontend.onrender.com
- Kiểm tra trang load thành công
- Kiểm tra menu navigation

### 3. OCR Demo Test
- Truy cập: https://restaurant-inventory-frontend.onrender.com/ocr-demo
- Kiểm tra OCR Status Panel
- Test upload ảnh hóa đơn

## 🛠️ Troubleshooting

### Lỗi Backend không start
```
❌ Backend deployment failed
```

**Khắc phục:**
1. Kiểm tra DATABASE_URL có đúng format không
2. Kiểm tra JWT_SECRET có được set không
3. Xem logs trong Render Dashboard

### Lỗi Frontend build
```
❌ Frontend build failed
```

**Khắc phục:**
1. Kiểm tra Node.js version (cần 18+)
2. Kiểm tra build script có executable không
3. Xem build logs chi tiết

### Lỗi CORS
```
❌ CORS error khi gọi API
```

**Khắc phục:**
1. Kiểm tra FRONTEND_URL trong backend env
2. Kiểm tra CORS configuration trong app.ts
3. Verify domain names

### Lỗi Database Connection
```
❌ Database connection failed
```

**Khắc phục:**
1. Kiểm tra DATABASE_URL format
2. Verify database credentials
3. Check network connectivity

## 📊 Monitoring

### Render Dashboard
- **Logs**: Xem real-time logs
- **Metrics**: CPU, Memory, Response time
- **Deployments**: Lịch sử deploy

### Health Checks
- **Backend**: `/api/health` endpoint
- **Frontend**: Static file serving
- **OCR**: Connection test panel

## 🔒 Security

### Environment Variables
- ✅ JWT_SECRET auto-generated
- ✅ DATABASE_URL encrypted
- ✅ API keys secured

### CORS Configuration
- ✅ Frontend domain whitelisted
- ✅ HTTPS enforced
- ✅ Secure headers

### File Upload
- ✅ File size limits
- ✅ Type validation
- ✅ Secure storage

## 📈 Performance

### Backend Optimization
- ✅ Compression enabled
- ✅ Caching headers
- ✅ Database connection pooling

### Frontend Optimization
- ✅ Static file compression
- ✅ CDN delivery
- ✅ Lazy loading

## 🔄 Auto Deploy

### GitHub Integration
- ✅ Auto deploy on push to main
- ✅ Preview deployments for PRs
- ✅ Rollback capability

### Environment Management
- ✅ Separate dev/prod environments
- ✅ Environment-specific configs
- ✅ Secrets management

## 📞 Support

### Render Support
- Documentation: https://render.com/docs
- Community: https://community.render.com
- Status: https://status.render.com

### Project Issues
- Check logs trong Render Dashboard
- Verify environment variables
- Test endpoints manually

## 🎯 Best Practices

### Code Quality
- ✅ TypeScript strict mode
- ✅ ESLint configuration
- ✅ Error handling

### Deployment
- ✅ Blueprint configuration
- ✅ Environment separation
- ✅ Health checks

### Monitoring
- ✅ Log aggregation
- ✅ Performance metrics
- ✅ Error tracking

## 🚀 Next Steps

### Post-Deployment
1. Test tất cả features
2. Monitor performance
3. Set up alerts
4. Document procedures

### Maintenance
1. Regular security updates
2. Performance monitoring
3. Database backups
4. Log rotation

---

**Status**: ✅ Ready for Production  
**Last Updated**: 2025-01-07  
**Version**: 1.0.0